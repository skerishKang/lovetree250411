import{u as F,a as z,b as B,c as P,d as D,r as a,f as H,j as e,e as K,g as U}from"./index-Bv4-c3_I.js";import{s as V}from"./authSelectors-BIIj14MV.js";const G=()=>{var v,y,k,C,S,$;const{id:r}=F(),o=z();B();const i=P(),{currentTree:t,loading:E,error:m}=D(s=>s.trees),l=D(V),[p,x]=a.useState(!1),[g,f]=a.useState(""),[w,j]=a.useState(""),[I,N]=a.useState(!1),[h,L]=a.useState(""),u=!!(l&&((v=t==null?void 0:t.likes)!=null&&v.includes(l._id))),n=!!(l&&((y=t==null?void 0:t.followers)!=null&&y.includes(l._id)));a.useEffect(()=>{r&&(console.log("트리 상세 정보 조회 시도:",r),i(H(r)))},[i,r]),a.useEffect(()=>{t&&(f(t.title),j(t.description),L(`${window.location.origin}/trees/${r}`))},[t,r]);const R=async()=>{if(t)try{await i(K({id:t._id,title:g,description:w})),x(!1)}catch(s){console.error("트리 정보 수정 실패:",s)}},T=()=>{N(!0)},A=()=>{navigator.clipboard.writeText(h),alert("URL이 클립보드에 복사되었습니다.")},d=s=>{let c;const b=encodeURIComponent(h),_=encodeURIComponent(t.title);switch(s){case"twitter":c=`https://twitter.com/intent/tweet?url=${b}&text=${_}`;break;case"facebook":c=`https://www.facebook.com/sharer/sharer.php?u=${b}`;break;case"kakao":alert("카카오톡 공유 기능은 카카오 SDK 연동이 필요합니다.");return;case"telegram":c=`https://t.me/share/url?url=${b}&text=${_}`;break;default:return}window.open(c,"_blank")},M=()=>{var s;!l||!t||u||(t.likes=[...t.likes||[],l._id],(s=t.author)!=null&&s.id&&l._id!==t.author.id&&i(U({_id:`${t.id}-like-${l._id}-${Date.now()}`,type:"like",sender:l,post:{_id:t.id,content:t.title},read:!1,createdAt:new Date().toISOString()})))},O=()=>{var s;!l||!t||n||(t.followers=[...t.followers||[],l._id],(s=t.author)!=null&&s.id&&l._id!==t.author.id&&i(U({_id:`${t.id}-follow-${l._id}-${Date.now()}`,type:"follow",sender:l,post:{_id:t.id,content:t.title},read:!1,createdAt:new Date().toISOString()})))};return t&&t.isPublic===!1&&(!l||l._id!==(((k=t.author)==null?void 0:k.id)||((C=t.author)==null?void 0:C._id)))?e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"비공개 트리입니다"}),e.jsx("p",{className:"mb-4",children:"이 트리는 작성자 본인만 볼 수 있습니다."}),e.jsx("button",{onClick:()=>o("/trees"),className:"mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"트리 목록으로 이동"})]})}):E==="pending"?e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx("div",{className:"flex justify-center items-center min-h-[200px]",children:e.jsxs("div",{className:"text-gray-600",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-gray-500 mr-2 inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"트리 정보를 불러오는 중..."]})})}):m?e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"오류가 발생했습니다"}),e.jsx("p",{className:"mb-4",children:m}),e.jsx("button",{onClick:()=>o("/trees"),className:"mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"트리 목록으로 이동"})]})}):t?e.jsx("div",{className:"tree-detail-container h-full min-h-screen w-full max-w-full p-2 sm:p-4 overflow-x-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 w-full max-w-3xl mx-auto flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:"flex-grow",children:p?e.jsxs("div",{children:[e.jsx("input",{type:"text",value:g,onChange:s=>f(s.target.value),className:"w-full text-2xl font-bold mb-2 p-2 border rounded"}),e.jsx("textarea",{value:w,onChange:s=>j(s.target.value),className:"w-full h-32 p-2 border rounded text-gray-600",placeholder:"트리 설명을 입력하세요..."})]}):e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:t.title}),e.jsx("p",{className:"text-gray-600",children:t.description}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:t.tags.map(s=>e.jsxs("button",{onClick:()=>o(`/trees?tag=${encodeURIComponent(s)}`),className:"px-2 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors border border-blue-100",children:["#",s]},s))})]})}),e.jsx("div",{className:"text-sm text-gray-500 ml-4",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>o("/trees"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"목록으로 돌아가기"}),p?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:R,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"저장하기"}),e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"취소"})]}):e.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"트리 정보 수정하기"}),e.jsx("button",{onClick:()=>o(`/trees/${r}/edit`),className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors",children:"트리 편집하기"}),e.jsx("button",{onClick:T,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"공유"}),e.jsxs("button",{onClick:M,disabled:u||!l,className:`px-4 py-2 rounded transition-colors duration-200 ${u?"bg-pink-200 text-pink-600":"bg-pink-500 text-white hover:bg-pink-600"}`,children:["❤️ 좋아요 ",((S=t.likes)==null?void 0:S.length)||0]}),e.jsxs("button",{onClick:O,disabled:n||!l,className:`px-4 py-2 rounded transition-colors duration-200 ${n?"bg-green-200 text-green-600":"bg-green-500 text-white hover:bg-green-600"}`,children:[n?"팔로잉":"팔로우"," ",(($=t.followers)==null?void 0:$.length)||0]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-96",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"트리 공유하기"}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"공유 URL"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:h,readOnly:!0,className:"flex-1 px-3 py-2 border rounded-l-md"}),e.jsx("button",{onClick:A,className:"px-4 py-2 bg-blue-500 text-white rounded-r-md hover:bg-blue-600",children:"복사"})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:()=>d("twitter"),className:"p-2 bg-blue-400 text-white rounded-full hover:bg-blue-500",children:"트위터"}),e.jsx("button",{onClick:()=>d("facebook"),className:"p-2 bg-blue-600 text-white rounded-full hover:bg-blue-700",children:"페이스북"}),e.jsx("button",{onClick:()=>d("kakao"),className:"p-2 bg-yellow-400 text-white rounded-full hover:bg-yellow-500",children:"카카오"}),e.jsx("button",{onClick:()=>d("telegram"),className:"p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600",children:"텔레그램"})]})]})})]})}):e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"트리를 찾을 수 없습니다"}),e.jsx("p",{className:"mb-4",children:"요청하신 트리가 존재하지 않거나 삭제되었을 수 있습니다."}),e.jsx("button",{onClick:()=>o("/trees"),className:"mt-2 px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors",children:"트리 목록으로 이동"})]})})};export{G as default};
//# sourceMappingURL=TreeDetail-C4mOGVDS.js.map
